<?php
//
class ESSBAddonsHelper {

	private $cache_options_slug = "essb3_addons";
	private $announced_addons_slug = "essb3_addons_announce";
	private $update_addons_server = "http://extensions.appscreo.com/4/"; //"http://addons.appscreo.com";

	private $base_addons = 'eyJlc3NiLXZpZGVvLXNoYXJlLWV2ZW50cyI6eyJzbHVnIjoiZXNzYi12aWRlby1zaGFyZS1ldmVudHMiLCJuYW1lIjoiVmlkZW8gU2hhcmluZyBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMTEucG5nIiwiZGVzY3JpcHRpb24iOiJBIG11c3QgaGF2ZSB0b29sIGZvciBlYWNoIHZpZGVvIG1hcmtldGluZyBjYW1wYWlnbi4gQWRkIGJlYXV0aWZ1bCBjYWxsIHRvIGFjdGlvbnMgb24gc3BlY2lmaWMgZXZlbnRzIHRvIGluY3JlYXNlIHlvdXIgc29jaWFsIHNoYXJlcywgc29jaWFsIGZvbGxvd2luZywgbWFpbGluZyBsaXN0LCB5b3VyIG1hcmtldGluZyBtZXNzYWdlIGF0IHRoZSByaWdodCB0aW1lIG9yIGp1c3Qgc2hhcmUgYnV0dG9ucy4iLCJwcmljZSI6IiQxNCIsInBhZ2UiOiJodHRwczpcL1wvY29kZWNhbnlvbi5uZXRcL2l0ZW1cL3ZpZGVvLXNoYXJpbmctYWRkb24tZm9yLWVhc3ktc29jaWFsLXNoYXJlLWJ1dHRvbnNcLzg0MzQ0NjciLCJkZW1vX3VybCI6Imh0dHA6XC9cL3ByZXZpZXcuY29kZWNhbnlvbi5uZXRcL2l0ZW1cL3ZpZGVvLXNoYXJpbmctYWRkb24tZm9yLWVhc3ktc29jaWFsLXNoYXJlLWJ1dHRvbnNcL2Z1bGxfc2NyZWVuX3ByZXZpZXdcLzg0MzQ0NjciLCJjaGVjayI6IkVTU0IzX1ZTRV9WRVJTSU9OIiwidGFncyI6Im5ldyIsImNhdGVnb3J5IjoidmlkZW8gc2hhcmluZyIsInJlcXVpcmVzIjoiNC4wIiwiZmlsdGVycyI6InZpZGVvLGZ1bmN0aW9uLHBhaWQifSwiZXNzYi1vcHRpbi1ib29zdGVyIjp7InNsdWciOiJlc3NiLW9wdGluLWJvb3N0ZXIiLCJuYW1lIjoiT3B0LWluIEJvb3N0ZXIgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXMtc3Vic2NyaWJlLnBuZyIsImRlc2NyaXB0aW9uIjoiRGlzcGxheSBvcHQtaW4gZm9ybXMgYmFzZWQgb24gdmFyaW91cyBjb25kaXRpb25zOiB0aW1lIGRlbGF5LCBzY3JvbGwgb3IgZXhpdCBpbnRlbnQgYW5kIGluY3JlYXNlIHlvdXIgc3Vic2NyaWJlcnMuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itb3B0aW4tYm9vc3RlciIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCM19PRk9CX1ZFUlNJT04iLCJ0YWdzIjoibmV3IiwiY2F0ZWdvcnkiOiJzdWJzY3JpYmUgZXh0ZW5zaW9uIiwicmVxdWlyZXMiOiI0LjAuMyIsImZpbHRlcnMiOiJzdWJzY3JpYmUsbmV3LGZyZWUifSwiZXNzYi10ZW1wbGF0ZS1jaHJpc3RtYXMiOnsic2x1ZyI6ImVzc2ItdGVtcGxhdGUtY2hyaXN0bWFzIiwibmFtZSI6IlRlbXBsYXRlczogQ2hyaXN0bWFzIHBhY2siLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy10ZW1wbGF0ZS5wbmciLCJkZXNjcmlwdGlvbiI6IlByZXBhcmUgeW91ciBzaXRlIGZvciB1cGNvbWluZyBDaHJpc3RtYXMgYW5kIE5ldyBZZWFyIHdpdGggdHdvIHNwZWNpYWwgQ2hyaXN0bWFzIHRlbXBsYXRlcyIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLXRlbXBsYXRlLWNocmlzdG1hcyIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX1RFTVBMQVRFUEFDS19DSFJJU1RNQVMiLCJ0YWdzIjoibmV3IiwiY2F0ZWdvcnkiOiJ0ZW1wbGF0ZXMiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6InRlbXBsYXRlLG5ldyxmcmVlIn0sImVzc2ItZGlzcGxheS13b29jb21tZXJjZWJhciI6eyJzbHVnIjoiZXNzYi1kaXNwbGF5LXdvb2NvbW1lcmNlYmFyIiwibmFtZSI6IkRpc3BsYXkgTWV0aG9kOiBXb29Db21tZXJjZSBCYXIiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IlNwZWNpYWwgZGVzaWduZWQgc2hhcmUgYmFyIGZvciBXb29Db21tZXJjZSBzdG9yZXMgd2l0aCBzaGFlciBidXR0b25zLCBwcm9kdWN0IHRpdGxlXC9wcmljZSBhbmQgYnV5IG5vdyBidXR0b24iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXdvb2NvbW1lcmNlYmFyIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfRE1fVlBfUExVR0lOX1VSTCIsInRhZ3MiOiJuZXciLCJjYXRlZ29yeSI6ImRpc3BsYXkgbWV0aG9kIiwicmVxdWlyZXMiOiI0LjAuMiIsImZpbHRlcnMiOiJkaXNwbGF5LG5ldyxmcmVlIn0sImVzc2ItZGlzcGxheS12aXJhbHBvaW50Ijp7InNsdWciOiJlc3NiLWRpc3BsYXktdmlyYWxwb2ludCIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogVmlyYWwgUG9pbnQiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IlN1cGVyIGNvb2wgc2hhcmUgcG9pbnQgZGVzaWduIHdpdGggYXV0b21hdGljIHRyaWdnZXIgb24gaG92ZXIsIGV5ZSBjYXRjaGluZyBkZXNpZ24gYW5kIGFuaW1hdGlvbnMiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXZpcmFscG9pbnQiLCJkZW1vX3VybCI6IiIsImNoZWNrIjoiRVNTQl9ETV9WUF9QTFVHSU5fVVJMIiwidGFncyI6Im5ldyIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksbmV3LGZyZWUifSwiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGZsb2F0Ijp7InNsdWciOiJlc3NiLWRpc3BsYXktc3VwZXJwb3N0ZmxvYXQiLCJuYW1lIjoiRGlzcGxheSBNZXRob2Q6IFN1cGVyIFBvc3QgRmxvYXQiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IkV4dGVuZGVkIHZlcnNpb24gb2YgcG9zdCB2ZXJ0aWNhbCBmbG9hdCB3aXRoIGNhbGwgdG8gYWN0aW9uIG1lc3NhZ2UgYW5kIGRpc3BsYXkgb2YgdG90YWxcL2NvbW1lbnRzIGNvdW50IiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2ItZGlzcGxheS1zdXBlcnBvc3RmbG9hdCIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX0RNX1NQRl9QTFVHSU5fVVJMIiwidGFncyI6Im5ldyIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksbmV3LGZyZWUifSwiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciI6eyJzbHVnIjoiZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogU3VwZXIgUG9zdCBCYXIiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlcy1wb3NpdGlvbi5wbmciLCJkZXNjcmlwdGlvbiI6IkV4dGVuZCB5b3VyIGJvdHRvbSBkaXNwbGF5IG1ldGhvZCB3aXRoIHN1cGVyIHBvc3QgYmFyLiBTdXBlciBwb3N0IGJhciBhbGxvd3MgZGlzcGxheSBvZiBwcmV2aW91c1wvbmV4dCBwb3N0IHRvby4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LXN1cGVycG9zdGJhciIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX0RNX1NQQl9QTFVHSU5fVVJMIiwidGFncyI6Im5ldyIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksbmV3LGZyZWUifSwiZXNzYi1kaXNwbGF5LW1vYmlsZS1zaGFyZWJhcmN0YSI6eyJzbHVnIjoiZXNzYi1kaXNwbGF5LW1vYmlsZS1zaGFyZWJhcmN0YSIsIm5hbWUiOiJEaXNwbGF5IE1ldGhvZDogTW9iaWxlIFNoYXJlIEJhciB3aXRoIENhbGwgdG8gQWN0aW9uIEJ1dHRvbiIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzLXBvc2l0aW9uLnBuZyIsImRlc2NyaXB0aW9uIjoiSW5jbHVkZSBtb2JpbGUgc2hhcmUgYmFyIHdpdGggY3VzdG9tIGNhbGwgdG8gYWN0aW9uIGJ1dHRvbiBuZXh0IHRvIHNoYXJlIGJ1dHRvbi4iLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1kaXNwbGF5LW1vYmlsZS1zaGFyZWJhcmN0YSIsImRlbW9fdXJsIjoiIiwiY2hlY2siOiJFU1NCX0RNX01TQkNUQV9QTFVHSU5fVVJMIiwidGFncyI6Im5ldyIsImNhdGVnb3J5IjoiZGlzcGxheSBtZXRob2QiLCJyZXF1aXJlcyI6IjQuMC4yIiwiZmlsdGVycyI6ImRpc3BsYXksbmV3LGZyZWUifSwiZXNzYi1zdWJzY3JpYmUtY29ubmVjdG9yLWpldHBhY2siOnsic2x1ZyI6ImVzc2Itc3Vic2NyaWJlLWNvbm5lY3Rvci1qZXRwYWNrIiwibmFtZSI6Ik9wdC1pbiBDb25uZWN0b3I6IEpldFBhY2sgU3Vic2NyaXB0aW9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzLXN1YnNjcmliZS5wbmciLCJkZXNjcmlwdGlvbiI6IkFjdGl2YXRlIHVzYWdlIG9mIEpldFBhY2sgU3Vic2NyaXB0aW9ucyBpbiBPcHQtaW4gTW9kdWxlIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itc3Vic2NyaWJlLWNvbm5lY3Rvci1qZXRwYWNrIiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0JfU1VCU0NSSUJFX0NPTk5FQ1RPUl9KRVRQQUNLIiwidGFncyI6Im5ldyIsImNhdGVnb3J5Ijoic3Vic2NyaWJlIGNvbm5lY3RvciIsInJlcXVpcmVzIjoiNC4wLjIiLCJmaWx0ZXJzIjoic3Vic2NyaWJlLG5ldyxmcmVlIn0sImVzc2Itc29jaWFsLWFiIjp7InNsdWciOiJlc3NiLXNvY2lhbC1hYiIsIm5hbWUiOiJTb2NpYWwgQVwvQiBWaXN1YWwgVGVzdHMgQWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTA3LnBuZyIsImRlc2NyaXB0aW9uIjoiSXQgd2FzIG5ldmVyIGJlZW4gc28gZWFzeSB0byBmaW5kIHdoYXQgd29ya3MgYmVzdCBmb3IgeW91ciBzaXRlLiBTZXR1cCB1cCB0byAzIGRpZmZlcmVudCBjb25maWd1cmF0aW9ucyBvZiBidXR0b25zIG9uIHlvdXIgc2l0ZSBhbmQgcnVuIHRoZSB0ZXN0cy4gWW91IHdpbGwgc2VlIHJlYWwgdGltZSBzdGF0cyBvZiB3aGF0IHBlcmZvcm1zIGJlc3QuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itc29jaWFsLWFiIiwiZGVtb191cmwiOiJodHRwOlwvXC9zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvc29jaWFsLWFiXC8iLCJjaGVjayI6IkVTU0IzX0FCX1ZFUlNJT04iLCJ0YWdzIjoidW5pcXVlLG5ldyIsImNhdGVnb3J5IjoiYW5hbHl0aWNzIiwicmVxdWlyZXMiOiI0LjAiLCJmaWx0ZXJzIjoiZnVuY3Rpb24sbmV3LGZyZWUifSwiZXNzYi1wb3N0LXZpZXdzIjp7InNsdWciOiJlc3NiLXBvc3Qtdmlld3MiLCJuYW1lIjoiUG9zdCBWaWV3cyBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMDIucG5nIiwiZGVzY3JpcHRpb24iOiJUcmFjayBhbmQgZGlzcGxheSBwb3N0IHZpZXdzXC9yZWFkcyB3aXRoIHlvdXIgc2hhcmUgYnV0dG9ucyBhbmQgYWxzbyBkaXNwbGF5IG1vc3QgcG9wdWxhciBwb3N0cyB3aXRoIHdpZGdldCBvciBzaG9ydGNvZGUuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2ItcG9zdC12aWV3cyIsImRlbW9fdXJsIjoiaHR0cDpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cL3ZpZXdzcmVhZHMtY291bnRlclwvIiwidGFncyI6InBvcHVsYXIiLCJjaGVjayI6IkVTU0IzX1BWX1ZFUlNJT04iLCJjYXRlZ29yeSI6ImZlYXR1cmUiLCJyZXF1aXJlcyI6IjMuMCIsImZpbHRlcnMiOiJmdWN0aW9uLGZyZWUifSwiZXNzYi1mYWNlYm9vay1jb21tZW50cyI6eyJzbHVnIjoiZXNzYi1mYWNlYm9vay1jb21tZW50cyIsIm5hbWUiOiJGYWNlYm9vayBDb21tZW50cyBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMDQucG5nIiwiZGVzY3JpcHRpb24iOiJBdXRvbWF0aWNhbGx5IGluY2x1ZGUgRmFjZWJvb2sgY29tbWVudHMgdG8geW91ciBibG9nIHdpdGggbW9kZXJhdGlvbiBvcHRpb24gYmVsb3cgcG9zdHMiLCJwcmljZSI6IkZSRUUiLCJwYWdlIjoiaHR0cDpcL1wvZ2V0LnNvY2lhbHNoYXJpbmdwbHVnaW4uY29tXC8/ZG93bmxvYWQ9ZXNzYi1mYWNlYm9vay1jb21tZW50cyIsImRlbW9fdXJsIjoiaHR0cDpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cL2ZhY2Vib29rLWNvbW1lbnRzXC8/ZmJjb21tZW50c19kZW1vPXRydWUiLCJjaGVjayI6IkVTU0IzX0ZDX1ZFUlNJT04iLCJ0YWdzIjoicG9wdWxhciIsImNhdGVnb3J5IjoiZmVhdHVyZSIsInJlcXVpcmVzIjoiMy4wIiwiZmlsdGVycyI6ImZ1bmN0aW9uLGZyZWUifSwiZXNzYi1hbXAtc3VwcG9ydCI6eyJzbHVnIjoiZXNzYi1hbXAtc3VwcG9ydCIsIm5hbWUiOiJBTVAgU2hhcmUgQnV0dG9ucyBBZGQtb24gZm9yIEVhc3kgU29jaWFsIFNoYXJlIEJ1dHRvbnMiLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMDMucG5nIiwiZGVzY3JpcHRpb24iOiJJbmNsdWRlIHNoYXJlIGJ1dHRvbnMgb24geW91ciBBTVAgcGFnZXMgaWYgeW91IHVzZSBvZmZpY2lhbCBwbHVnaW4gV29yZFByZXNzIEFNUCIsInByaWNlIjoiRlJFRSIsInBhZ2UiOiJodHRwOlwvXC9nZXQuc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cLz9kb3dubG9hZD1lc3NiLWFtcC1zdXBwb3J0IiwiZGVtb191cmwiOiIiLCJjaGVjayI6IkVTU0IzX0FNUF9QTFVHSU5fUk9PVCIsInRhZ3MiOiJ1cGRhdGVkIiwiY2F0ZWdvcnkiOiJtb2JpbGUiLCJyZXF1aXJlcyI6IjQuMCIsImZpbHRlcnMiOiJmdW5jdGlvbixmcmVlIn0sImVzc2Itb3B0aW4tY29udGVudCI6eyJzbHVnIjoiZXNzYi1vcHRpbi1jb250ZW50IiwibmFtZSI6Ik9wdC1pbiBGb3JtcyBCZWxvdyBDb250ZW50IEFkZC1vbiBmb3IgRWFzeSBTb2NpYWwgU2hhcmUgQnV0dG9ucyIsImltYWdlIjoiaHR0cDpcL1wvYWRkb25zLmFwcHNjcmVvLmNvbVwvaVwvYWRkb25faW1hZ2VzNC0wNi5wbmciLCJkZXNjcmlwdGlvbiI6IkF1dG9tYXRpY2FsbHkgaW5jbHVkZSBvcHQtaW4gZm9ybXMgZnJvbSBFYXN5IE9wdGluIGJlbG93IHBvc3QgY29udGVudC4gRWFzeSBnZXQgbW9yZSBuZXcgc3Vic2NyaWJlcnMgdG8geW91ciBtYWlsaW5nIGxpc3QuIiwicHJpY2UiOiJGUkVFIiwicGFnZSI6Imh0dHA6XC9cL2dldC5zb2NpYWxzaGFyaW5ncGx1Z2luLmNvbVwvP2Rvd25sb2FkPWVzc2Itb3B0aW4tY29udGVudCIsImRlbW9fdXJsIjoiaHR0cDpcL1wvc29jaWFsc2hhcmluZ3BsdWdpbi5jb21cL2Vhc3ktb3B0aW5cLyIsImNoZWNrIjoiRVNTQjNfT0ZfVkVSU0lPTiIsInRhZ3MiOiJuZXciLCJjYXRlZ29yeSI6ImZlYXR1cmUiLCJyZXF1aXJlcyI6IjQuMCIsImZpbHRlcnMiOiJzdWJzY3JpYmUsZnJlZSJ9LCJoZWxsby1mb2xsb3dlcnMiOnsic2x1ZyI6ImhlbGxvLWZvbGxvd2VycyIsIm5hbWUiOiJIZWxsbyBGb2xsb3dlcnMgLSBTb2NpYWwgQ291bnRlciBQbHVnaW4iLCJpbWFnZSI6Imh0dHA6XC9cL2FkZG9ucy5hcHBzY3Jlby5jb21cL2lcL2FkZG9uX2ltYWdlczQtMDUucG5nIiwiZGVzY3JpcHRpb24iOiJCZWF0aWZ1bCBhbmQgdW5pcXVlIGV4dGVuc2lvbiBvZiB5b3VyIGN1cnJlbnQgc29jaWFsIGZvbGxvd2VycyB3aXRoIGNvdmVyIGJveGVzLCBsYXlvdXQgYnVpbGRlciwgYWR2YW5jZWQgY3VzdG9taXplciwgcHJvZmlsZSBhbmFseXRpY3MuIFRyeSB0aGUgbGl2ZSBkZW1vIHRvIHRlc3QuIiwicHJpY2UiOiIkMjQiLCJwYWdlIjoiaHR0cDpcL1wvY29kZWNhbnlvbi5uZXRcL2l0ZW1cL2hlbGxvLWZvbGxvd2Vycy1zb2NpYWwtY291bnRlci1wbHVnaW4tZm9yLXdvcmRwcmVzc1wvMTU4MDE3MjkiLCJkZW1vX3VybCI6Imh0dHA6XC9cL2NvZGVjYW55b24ubmV0XC9pdGVtXC9oZWxsby1mb2xsb3dlcnMtc29jaWFsLWNvdW50ZXItcGx1Z2luLWZvci13b3JkcHJlc3NcL2Z1bGxfc2NyZWVuX3ByZXZpZXdcLzE1ODAxNzI5IiwiY2hlY2siOiJIRl9WRVJTSU9OIiwiY2F0ZWdvcnkiOiJwYWlkIiwicmVxdWlyZXMiOiIxLjAiLCJmaWx0ZXJzIjoicGFpZCJ9LCJlc3NiLXNlbGYtc2hvcnQtdXJsIjp7InNsdWciOiJlc3NiLXNlbGYtc2hvcnQtdXJsIiwibmFtZSI6IlNlbGYtSG9zdGVkIFNob3J0IFVSTHMgYWRkLW9uIGZvciBFYXN5IFNvY2lhbCBTaGFyZSBCdXR0b25zIiwiaW1hZ2UiOiJodHRwOlwvXC9hZGRvbnMuYXBwc2NyZW8uY29tXC9pXC9hZGRvbl9pbWFnZXM0LTAxLnBuZyIsImRlc2NyaXB0aW9uIjoiR2VuZXJhdGUgc2VsZiBob3N0ZWQgc2hvcnQgVVJMcyBkaXJlY3RseSBmcm9tIHlvdXIgV29yZFByZXNzIHdpdGhvdXQgZXh0ZXJuYWwgc2VydmljZXMgbGlrZSBodHRwOlwvXC9kb21haW4uY29tXC9heFdzYSBvciBjdXN0b20gYmFzZWQgaHR0cDpcL1wvZG9tYWluLmNvbVwvZXNzYi4iLCJwcmljZSI6IiQxNCIsInBhZ2UiOiJodHRwOlwvXC9jb2RlY2FueW9uLm5ldFwvaXRlbVwvc2VsZi1ob3N0ZWQtc2hvcnQtdXJscy1hZGRvbi1mb3ItZWFzeS1zb2NpYWwtc2hhcmUtYnV0dG9uc1wvMTUwNjY0NDciLCJkZW1vX3VybCI6Imh0dHA6XC9cL2NvZGVjYW55b24ubmV0XC9pdGVtXC9zZWxmLWhvc3RlZC1zaG9ydC11cmxzLWFkZG9uLWZvci1lYXN5LXNvY2lhbC1zaGFyZS1idXR0b25zXC9mdWxsX3NjcmVlbl9wcmV2aWV3XC8xNTA2NjQ0NyIsImNoZWNrIjoiRVNTQjNfU1NVX1ZFUlNJT04iLCJjYXRlZ29yeSI6InBhaWQiLCJyZXF1aXJlcyI6IjMuMS4yIiwiZmlsdGVycyI6ImZ1bmN0aW9uLHBhaWQifSwiZmlsdGVycyI6eyJhbGwiOiJBbGwiLCJuZXciOiJOZXciLCJmcmVlIjoiRnJlZSIsImRpc3BsYXkiOiJEaXNwbGF5IE1ldGhvZHMiLCJ0ZW1wbGF0ZSI6IlRlbXBsYXRlcyIsInN1YnNjcmliZSI6Ik9wdC1pbiBBZGQtb25zIiwidmlkZW8iOiJWaWRlbyBTaGFyaW5nIiwiZnVuY3Rpb24iOiJGdW5jdGlvbnMiLCJwYWlkIjoiUGFpZCJ9fQ==';
	private $base_addons_data;

	private static $instance = null;
	public static function get_instance() {

		if ( null == self::$instance ) {
			self::$instance = new self;
		}

		return self::$instance;

	} // end get_instance;

	function __construct() {
		$remote_result = base64_decode ( $this->base_addons );
		
		$remote_result = htmlspecialchars_decode ( $remote_result );
		$remote_result = stripslashes ( $remote_result );
		$info = json_decode($remote_result, true);
		if (is_array($info)) {
			//update_option($this->cache_options_slug, $info);
			$this->base_addons_data = $info;
		}
	}


	public function call_remove_addon_list_update() {		
		$url = $this->update_addons_server;
		$result = wp_remote_get($url);
		$success_connection = true;

		if(is_wp_error($result) or (wp_remote_retrieve_response_code($result) != 200)){
			$success_connection = false;
		}
			
		/* Check for incorrect data */
		if ($success_connection) {
			$remote_result = wp_remote_retrieve_body($result);
			$remote_result = base64_decode ( $remote_result );
				
			$remote_result = htmlspecialchars_decode ( $remote_result );
			$remote_result = stripslashes ( $remote_result );
			$info = json_decode($remote_result, true);
			if (is_array($info)) {
				update_option($this->cache_options_slug, $info);
			}
		}
	}

	public function get_addons() {
		$addons = get_option($this->cache_options_slug);

		if (!$addons) {
			$addons = $this->base_addons_data;
		}
		
		if (!is_array($addons)) {
			$addons = array();
		}
		
		return $addons;
	}

	public function get_new_addons() {
		/*if (false === get_transient($this->cache_options_slug)) {
			$this->call_remove_addon_list_update();
			delete_transient($this->cache_options_slug);
			set_transient( $this->cache_options_slug, 'updated', 168 * HOUR_IN_SECONDS );
		}*/

		$addons = $this->get_addons();

		if (!is_array($addons)) {
			$addons = array();
		}

		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		$list_of_new = array();
		foreach ($addons as $addon_key => $addon_data) {
			if ($addon_key == "filters") continue;
			if (!isset($current_announced[$addon_key])) {
				$list_of_new[$addon_key] = array("title" => $addon_data['name'], "url" => $addon_data['page']);
			}
		}


		return $list_of_new;
	}

	public function get_new_addons_count() {
		/*if (false === get_transient($this->cache_options_slug)) {
			$this->call_remove_addon_list_update();
			delete_transient($this->cache_options_slug);
			set_transient( $this->cache_options_slug, 'updated', 168 * HOUR_IN_SECONDS );
		}*/

		$addons = $this->get_addons();

		if (!is_array($addons)) {
			$addons = array();
		}

		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		$list_of_new = 0;
		foreach ($addons as $addon_key => $addon_data) {
			if ($addon_key == "filters") continue;
			if (!isset($current_announced[$addon_key])) {
				$list_of_new++;
			}
		}


		return $list_of_new;
	}

	public function dismiss_addon_notice($addon) {
		$current_announced = get_option($this->announced_addons_slug);
		if (!is_array($current_announced)) {
			$current_announced = array();
		}

		if (strpos($addon, ',') == false) {
			$current_announced[$addon] = "yes";
		}
		else {
			$addon_list = explode(',', $addon);
			foreach ($addon_list as $one) {
				$current_announced[$one] = "yes";
			}
		}

		update_option($this->announced_addons_slug, $current_announced);
	}
}

?>